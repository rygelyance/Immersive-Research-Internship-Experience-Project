---
title: "Calculate Affected Demographics"
format: html
editor: visual
---

In this document, you will calculate station-level PM2.5 changes. Afterward, you will calculate impacted demographic groups around each station.

# Calculating Station-Level Pollution Change

```{r}
library("tidyverse")
library("knitr")
```

Upload your team's full data frame required to estimate the impact of light rails on PM2.5 levels surrounding all stations. Below is a simplified example.

```{r}
df<-read.csv("Mega_Dataframe.csv") 

df2<-df %>%
  mutate(date=as.Date(date, format='%Y-%m-%d'))

#period of analysis
startdate<-as.Date("2000-06-01", format='%Y-%m-%d')
enddate<-as.Date("2008-06-01", format='%Y-%m-%d')

#opening data of metro
opendate<-as.Date("2004-06-14", format='%Y-%m-%d')

#date when groundbreak starts
conststart <- as.Date("2001-01-17", format = "%Y-%m-%d")

#Heavy-Duty Engine and Vehicle Standards
HD_Engine <- as.Date("2007-01-01", format = "%Y-%m-%d")
#Nonroad Diesel Rule
NR_Diesel <- as.Date("2004-06-29", format = "%Y-%m-%d")
#Minnesota Mercury Reduction Act
MC_Reduction <- as.Date("2006-05-11", format = "%Y-%m-%d")
#Next Gen Energy Act
NG_Energy <- as.Date("2007-05-25", format = "%Y-%m-%d")
#2030 Regional Development Framework
RDF <- as.Date("2004-01-01", format = "%Y-%m-%d")
#Clean Air Minnesota Initiative
CA_Init <- as.Date("2003-01-01", format = "%Y-%m-%d")
#Minnesota Renewable Energy Standard
RE_Standard <- as.Date("2001-01-01", format = "%Y-%m-%d")
#Vehicle Emissions Inspection and Maintenance Programs
VE_Programs <- as.Date("2001-04-05", format = "%Y-%m-%d")

df3 <- df2 %>%
  filter(date>=startdate & date <= enddate) %>%
  mutate(MetroOpen = ifelse(date >= opendate, 1, 0)) %>%
  mutate(dow = wday(date)) %>%
  mutate(construction = ifelse(date > conststart & date < opendate, 1, 0)) %>%
  group_by(station_num) %>%
  arrange(station_num, date) %>%
  mutate(t = as.numeric(date-startdate)) %>%
  mutate(t2 = t^2, t3 = t^3, t4 = t^4) %>%
  mutate(l_tair = lag(Tair_f_tavg)) %>%
  mutate(l_tair_2 = l_tair^2) %>%
  mutate(l_tair_3 = l_tair^3) %>%
  mutate(l_tair_4 = l_tair^4) %>%
  mutate(l_qair = lag(Qair_f_tavg)) %>%
  mutate(l_qair_2 = l_qair^2) %>%
  mutate(l_qair_3 = l_qair^3) %>%
  mutate(l_qair_4 = l_qair^4) %>%
  mutate(l_wind = lag(Wind_f_tavg)) %>%
  mutate(l_wind_2 = l_wind^2) %>%
  mutate(l_wind_3 = l_wind^3) %>%
  mutate(l_wind_4 = l_wind^4) %>%
  mutate(CA_Init = ifelse(date >= CA_Init, 1, 0)) %>%
  mutate(HD_Engine = ifelse(date >= HD_Engine, 1, 0)) %>%
  mutate(MC_Reduction = ifelse(date >= MC_Reduction, 1, 0)) %>%
  mutate(NG_Energy = ifelse(date >= NG_Energy, 1, 0)) %>%
  mutate(NR_Diesel = ifelse(date >= NR_Diesel, 1, 0)) %>%
  mutate(RDF = ifelse(date >= RDF, 1, 0)) %>%
  mutate(RE_Standard = ifelse(date >= RE_Standard, 1, 0)) %>%
  mutate(VE_Programs = ifelse(date >= VE_Programs, 1, 0))
```

Run stations level regressions. Use the best regression specification (in your team's opinion) from the average effect calculation.

```{r}
summary(m1 <- lm(log(pm25) ~ MetroOpen:as.factor(station_num) +
                   construction +
                   Tair_f_tavg +
                   l_tair +
                   l_tair_2 +
                   l_tair_3 +
                   l_tair_4 +
                   Qair_f_tavg +
                   l_qair +
                   l_qair_2 +
                   l_qair_3 +
                   l_qair_4 +
                   Wind_f_tavg +
                   l_wind +
                   l_wind_2 +
                   l_wind_3 +
                   l_wind_4 +
                   holiday +
                   t +
                   t2 +
                   t3 +
                   t4 +
                   as.factor(month) +
                   as.factor(dow)
                   , data = df3))
```

The code below prints out the station-level effect and the p-values

```{r}
c <- coef(m1)
len_coef<-length(coef(m1))

#get coefficients of the station-level effect
coef<-coef(m1)[(len_coef-36): len_coef]

#get p values of the station-level effect (p<0.05 is statistically significant)
pval<-summary(m1)$coefficients[,4][(len_coef-3): len_coef]

kable(cbind(coef, pval), digits=2)
```

# Query demographic data

Helpful resource: <https://walker-data.com/tidycensus/articles/basic-usage.html>

Get census key

```{r}
library(tidycensus)
api_key <- "512f3cbcfc69f2d02ddabb5d78704b4df660fb75"
census_api_key(api_key, install=TRUE, overwrite = T)
readRenviron("~/.Renviron")
```

Identify variables that you would like to query

```{r}
vars<-load_variables(year=2000, dataset="sf1", cache = TRUE)
#P005001 Total
#P005003 White
#P005004 Black
#P005005 Native
#P005006 Asian
#P005010 Hispanic

#write.csv(vars, "census.csv")
```

Query variables

```{r}
targetvars<-c("P012002", "P012003", "P012004", "P012005", "P012006", "P012007", "P012008", "P012009", "P012010", "P012011", "P012012", "P012013", "P012014", "P012015", "P012016", "P012017", "P012018", "P012019", "P012020", "P012021", "P012022", "P012023", "P012024", "P012025", "P012026", "P012027", "P012028", "P012029", "P012030", "P012031", "P012032", "P012033", "P012034", "P012035", "P012036", "P012037", "P012038", "P012039", "P012040", "P012041", "P012042", "P012043", "P012044", "P012045", "P012046", "P012047", "P012048", "P012049")

age1<-get_decennial(year = 2000, geography = "block", variables=targetvars, state="MN", county="Hennepin", output="wide")
age2<-get_decennial(year = 2000, geography = "block", variables=targetvars, state="MN", county="Ramsey", output="wide")
age<-rbind(age1,age2)
```

Rename columns

```{r}
age_ranges<-age %>%
  rename(total_male="P012002", total_male_under_5_years="P012003", total_male_5_to_9_years="P012004", total_male_10_to_14_years="P012005", total_male_15_to_17_years="P012006", total_male_18_and_19_years="P012007", total_male_20_years="P012008", total_male_21_years="P012009", total_male_22_to_24_years="P012010", total_male_25_to_29_years="P012011", total_male_30_to_34_years="P012012", total_male_35_to_39_years="P012013", total_male_40_to_44_years="P012014", total_male_45_to_49_years="P012015", total_male_50_to_54_years="P012016", total_male_55_to_59_years="P012017", total_male_60_and_61_years="P012018", total_male_62_to_64_years="P012019", total_male_65_and_66_years="P012020", total_male_67_to_69_years="P012021", total_male_70_to_74_years="P012022", total_male_75_to_79_years="P012023", total_male_80_to_84_years="P012024", total_male_85_years_and_over="P012025", total_female="P012026", total_female_under_5_years="P012027", total_female_5_to_9_years="P012028", total_female_10_to_14_years="P012029", total_female_15_to_17_years="P012030", total_female_18_and_19_years="P012031", total_female_20_years="P012032", total_female_21_years="P012033", total_female_22_to_24_years="P012034", total_female_25_to_29_years="P012035", total_female_30_to_34_years="P012036", total_female_35_to_39_years="P012037", total_female_40_to_44_years="P012038", total_female_45_to_49_years="P012039", total_female_50_to_54_years="P012040", total_female_55_to_59_years="P012041", total_female_60_and_61_years="P012042", total_female_62_to_64_years="P012043", total_female_65_and_66_years="P012044", total_female_67_to_69_years="P012045", total_female_70_to_74_years="P012046", total_female_75_to_79_years="P012047", total_female_80_to_84_years="P012048", total_female_85_years_and_over="P012049")

```

# Calculate affected demographic group

```{r}
library("terra")
```

```{r}
buff<-vect("Station_Buffers.shp")
plot(buff)
```

Download shapefiles from [tigris package](https://github.com/walkerke/tigris)

```{r}
shape<-tigris::blocks(state="MN", county="Ramsey", class="sp", year=2000)
shape2<-tigris::blocks(state="MN", county="Hennepin", class="sp", year=2000)
shapevect1<-vect(shape)
shapevect2<-vect(shape2)
shapevect<-rbind(shapevect1, shapevect2)
shapedf<-as.data.frame(shapevect)

buff2 <- subset(buff, buff$FID == 19)
plot(buff)
lines(buff2, col = 'purple')

```

```{r}
blockage<-merge(shapevect, age_ranges, by.x="BLKIDFP00", by.y="GEOID")

blockage$blockarea<-expanse(blockage, unit="m")

blockagedf<-as.data.frame(blockage)

summary(blockagedf)

#100 percent match
```

Intersect blocks with buffers

```{r}
output<-c()

for (i in 0:36) {
  buff2 <- subset(buff, buff$FID == i)

  int<-crop(blockage, buff2)

  int$intarea<-expanse(int, unit="m")

  intdf<-as.data.frame(int)%>%
    mutate(frac_area=intarea/blockarea) %>%
    mutate(total_male=total_male*frac_area, 
         total_male_under_5_years=total_male_under_5_years*frac_area, 
         total_male_5_to_9_years=total_male_5_to_9_years*frac_area, 
         total_male_10_to_14_years=total_male_10_to_14_years*frac_area, 
         total_male_15_to_17_years=total_male_15_to_17_years*frac_area, 
         total_male_18_and_19_years=total_male_18_and_19_years*frac_area, 
         total_male_20_years=total_male_20_years*frac_area, 
         total_male_21_years=total_male_21_years*frac_area, 
         total_male_22_to_24_years=total_male_22_to_24_years*frac_area, 
         total_male_25_to_29_years=total_male_25_to_29_years*frac_area, 
         total_male_30_to_34_years=total_male_30_to_34_years*frac_area, 
         total_male_35_to_39_years=total_male_35_to_39_years*frac_area, 
         total_male_40_to_44_years=total_male_40_to_44_years*frac_area, 
         total_male_45_to_49_years=total_male_45_to_49_years*frac_area, 
         total_male_50_to_54_years=total_male_50_to_54_years*frac_area, 
         total_male_55_to_59_years=total_male_55_to_59_years*frac_area, 
         total_male_60_and_61_years=total_male_60_and_61_years*frac_area, 
         total_male_62_to_64_years=total_male_62_to_64_years*frac_area, 
         total_male_65_and_66_years=total_male_65_and_66_years*frac_area, 
         total_male_67_to_69_years=total_male_67_to_69_years*frac_area, 
         total_male_70_to_74_years=total_male_70_to_74_years*frac_area, 
         total_male_75_to_79_years=total_male_75_to_79_years*frac_area, 
         total_male_80_to_84_years=total_male_80_to_84_years*frac_area, 
         total_male_85_years_and_over=total_male_85_years_and_over*frac_area,
         total_female=total_female*frac_area, 
         total_female_under_5_years=total_female_under_5_years*frac_area, 
         total_female_5_to_9_years=total_female_5_to_9_years*frac_area, 
         total_female_10_to_14_years=total_female_10_to_14_years*frac_area, 
         total_female_15_to_17_years=total_female_15_to_17_years*frac_area, 
         total_female_18_and_19_years=total_female_18_and_19_years*frac_area, 
         total_female_20_years=total_female_20_years*frac_area, 
         total_female_21_years=total_female_21_years*frac_area, 
         total_female_22_to_24_years=total_female_22_to_24_years*frac_area, 
         total_female_25_to_29_years=total_female_25_to_29_years*frac_area, 
         total_female_30_to_34_years=total_female_30_to_34_years*frac_area, 
         total_female_35_to_39_years=total_female_35_to_39_years*frac_area, 
         total_female_40_to_44_years=total_female_40_to_44_years*frac_area, 
         total_female_45_to_49_years=total_female_45_to_49_years*frac_area, 
         total_female_50_to_54_years=total_female_50_to_54_years*frac_area, 
         total_female_55_to_59_years=total_female_55_to_59_years*frac_area, 
         total_female_60_and_61_years=total_female_60_and_61_years*frac_area, 
         total_female_62_to_64_years=total_female_62_to_64_years*frac_area, 
         total_female_65_and_66_years=total_female_65_and_66_years*frac_area, 
         total_female_67_to_69_years=total_female_67_to_69_years*frac_area, 
         total_female_70_to_74_years=total_female_70_to_74_years*frac_area, 
         total_female_75_to_79_years=total_female_75_to_79_years*frac_area, 
         total_female_80_to_84_years=total_female_80_to_84_years*frac_area, 
         total_female_85_years_and_over=total_female_85_years_and_over*frac_area) %>%
    summarize(total_male=sum(total_male), 
          total_male_under_5_years=sum(total_male_under_5_years), 
          total_male_5_to_9_years=sum(total_male_5_to_9_years), 
          total_male_10_to_14_years=sum(total_male_10_to_14_years), 
          total_male_15_to_17_years=sum(total_male_15_to_17_years), 
          total_male_18_and_19_years=sum(total_male_18_and_19_years), 
          total_male_20_years=sum(total_male_20_years), 
          total_male_21_years=sum(total_male_21_years), 
          total_male_22_to_24_years=sum(total_male_22_to_24_years), 
          total_male_25_to_29_years=sum(total_male_25_to_29_years), 
          total_male_30_to_34_years=sum(total_male_30_to_34_years), 
          total_male_35_to_39_years=sum(total_male_35_to_39_years), 
          total_male_40_to_44_years=sum(total_male_40_to_44_years), 
          total_male_45_to_49_years=sum(total_male_45_to_49_years), 
          total_male_50_to_54_years=sum(total_male_50_to_54_years), 
          total_male_55_to_59_years=sum(total_male_55_to_59_years), 
          total_male_60_and_61_years=sum(total_male_60_and_61_years), 
          total_male_62_to_64_years=sum(total_male_62_to_64_years), 
          total_male_65_and_66_years=sum(total_male_65_and_66_years), 
          total_male_67_to_69_years=sum(total_male_67_to_69_years), 
          total_male_70_to_74_years=sum(total_male_70_to_74_years), 
          total_male_75_to_79_years=sum(total_male_75_to_79_years), 
          total_male_80_to_84_years=sum(total_male_80_to_84_years), 
          total_male_85_years_and_over=sum(total_male_85_years_and_over), 
          total_female=sum(total_female), 
          total_female_under_5_years=sum(total_female_under_5_years), 
          total_female_5_to_9_years=sum(total_female_5_to_9_years), 
          total_female_10_to_14_years=sum(total_female_10_to_14_years), 
          total_female_15_to_17_years=sum(total_female_15_to_17_years), 
          total_female_18_and_19_years=sum(total_female_18_and_19_years), 
          total_female_20_years=sum(total_female_20_years), 
          total_female_21_years=sum(total_female_21_years), 
          total_female_22_to_24_years=sum(total_female_22_to_24_years), 
          total_female_25_to_29_years=sum(total_female_25_to_29_years), 
          total_female_30_to_34_years=sum(total_female_30_to_34_years), 
          total_female_35_to_39_years=sum(total_female_35_to_39_years), 
          total_female_40_to_44_years=sum(total_female_40_to_44_years), 
          total_female_45_to_49_years=sum(total_female_45_to_49_years), 
          total_female_50_to_54_years=sum(total_female_50_to_54_years), 
          total_female_55_to_59_years=sum(total_female_55_to_59_years), 
          total_female_60_and_61_years=sum(total_female_60_and_61_years), 
          total_female_62_to_64_years=sum(total_female_62_to_64_years), 
          total_female_65_and_66_years=sum(total_female_65_and_66_years), 
          total_female_67_to_69_years=sum(total_female_67_to_69_years), 
          total_female_70_to_74_years=sum(total_female_70_to_74_years), 
          total_female_75_to_79_years=sum(total_female_75_to_79_years), 
          total_female_80_to_84_years=sum(total_female_80_to_84_years), 
          total_female_85_years_and_over=sum(total_female_85_years_and_over)) %>%
  mutate(
      pct_total_male = total_male * 100 / total_male,
      pct_total_male_under_5_years = total_male_under_5_years * 100 / total_male,
      pct_total_male_5_to_9_years = total_male_5_to_9_years * 100 / total_male,
      pct_total_male_10_to_14_years = total_male_10_to_14_years * 100 / total_male,
      pct_total_male_15_to_17_years = total_male_15_to_17_years * 100 / total_male,
      pct_total_male_18_and_19_years = total_male_18_and_19_years * 100 / total_male,
      pct_total_male_20_years = total_male_20_years * 100 / total_male,
      pct_total_male_21_years = total_male_21_years * 100 / total_male,
      pct_total_male_22_to_24_years = total_male_22_to_24_years * 100 / total_male,
      pct_total_male_25_to_29_years = total_male_25_to_29_years * 100 / total_male,
      pct_total_male_30_to_34_years = total_male_30_to_34_years * 100 / total_male,
      pct_total_male_35_to_39_years = total_male_35_to_39_years * 100 / total_male,
      pct_total_male_40_to_44_years = total_male_40_to_44_years * 100 / total_male,
      pct_total_male_45_to_49_years = total_male_45_to_49_years * 100 / total_male,
      pct_total_male_50_to_54_years = total_male_50_to_54_years * 100 / total_male,
      pct_total_male_55_to_59_years = total_male_55_to_59_years * 100 / total_male,
      pct_total_male_60_and_61_years = total_male_60_and_61_years * 100 / total_male,
      pct_total_male_62_to_64_years = total_male_62_to_64_years * 100 / total_male,
      pct_total_male_65_and_66_years = total_male_65_and_66_years * 100 / total_male,
      pct_total_male_67_to_69_years = total_male_67_to_69_years * 100 / total_male,
      pct_total_male_70_to_74_years = total_male_70_to_74_years * 100 / total_male,
      pct_total_male_75_to_79_years = total_male_75_to_79_years * 100 / total_male,
      pct_total_male_80_to_84_years = total_male_80_to_84_years * 100 / total_male,
      pct_total_male_85_years_and_over = total_male_85_years_and_over * 100 / total_male,
      pct_total_female = total_female * 100 / total_female,
      pct_total_female_under_5_years = total_female_under_5_years * 100 / total_female,
      pct_total_female_5_to_9_years = total_female_5_to_9_years * 100 / total_female,
      pct_total_female_10_to_14_years = total_female_10_to_14_years * 100 / total_female,
      pct_total_female_15_to_17_years = total_female_15_to_17_years * 100 / total_female,
      pct_total_female_18_and_19_years = total_female_18_and_19_years * 100 / total_female,
      pct_total_female_20_years = total_female_20_years * 100 / total_female,
      pct_total_female_21_years = total_female_21_years * 100 / total_female,
      pct_total_female_22_to_24_years = total_female_22_to_24_years * 100 / total_female,
      pct_total_female_25_to_29_years = total_female_25_to_29_years * 100 / total_female,
      pct_total_female_30_to_34_years = total_female_30_to_34_years * 100 / total_female,
      pct_total_female_35_to_39_years = total_female_35_to_39_years * 100 / total_female,
      pct_total_female_40_to_44_years = total_female_40_to_44_years * 100 / total_female,
      pct_total_female_45_to_49_years = total_female_45_to_49_years * 100 / total_female,
      pct_total_female_50_to_54_years = total_female_50_to_54_years * 100 / total_female,
      pct_total_female_55_to_59_years = total_female_55_to_59_years * 100 / total_female,
      pct_total_female_60_and_61_years = total_female_60_and_61_years * 100 / total_female,
      pct_total_female_62_to_64_years = total_female_62_to_64_years * 100 / total_female,
      pct_total_female_65_and_66_years = total_female_65_and_66_years * 100 / total_female,
      pct_total_female_67_to_69_years = total_female_67_to_69_years * 100 / total_female,
      pct_total_female_70_to_74_years = total_female_70_to_74_years * 100 / total_female,
      pct_total_female_75_to_79_years = total_female_75_to_79_years * 100 / total_female,
      pct_total_female_80_to_84_years = total_female_80_to_84_years * 100 / total_female,
      pct_total_female_85_years_and_over = total_female_85_years_and_over * 100 / total_female
    )
  
  output<-rbind(output, intdf)
  
}
 
write.csv(output, "census_data_full.csv", row.names = F)

```

Summarize demographic groups that live near light rail stations

```{r}
sum_demog<-output %>%
  select(
  pct_total_male, 
  pct_total_male_under_5_years, 
  pct_total_male_5_to_9_years, 
  pct_total_male_10_to_14_years, 
  pct_total_male_15_to_17_years,
  pct_total_male_18_and_19_years, 
  pct_total_male_20_years, 
  pct_total_male_21_years, 
  pct_total_male_22_to_24_years, 
  pct_total_male_25_to_29_years, 
  pct_total_male_30_to_34_years, 
  pct_total_male_35_to_39_years, 
  pct_total_male_40_to_44_years, 
  pct_total_male_45_to_49_years, 
  pct_total_male_50_to_54_years, 
  pct_total_male_55_to_59_years, 
  pct_total_male_60_and_61_years, 
  pct_total_male_62_to_64_years, 
  pct_total_male_65_and_66_years, 
  pct_total_male_67_to_69_years, 
  pct_total_male_70_to_74_years, 
  pct_total_male_75_to_79_years, 
  pct_total_male_80_to_84_years, 
  pct_total_male_85_years_and_over, 
  pct_total_female, 
  pct_total_female_under_5_years, 
  pct_total_female_5_to_9_years, 
  pct_total_female_10_to_14_years, 
  pct_total_female_15_to_17_years, 
  pct_total_female_18_and_19_years, 
  pct_total_female_20_years, 
  pct_total_female_21_years, 
  pct_total_female_22_to_24_years, 
  pct_total_female_25_to_29_years, 
  pct_total_female_30_to_34_years, 
  pct_total_female_35_to_39_years, 
  pct_total_female_40_to_44_years, 
  pct_total_female_45_to_49_years, 
  pct_total_female_50_to_54_years, 
  pct_total_female_55_to_59_years, 
  pct_total_female_60_and_61_years, 
  pct_total_female_62_to_64_years, 
  pct_total_female_65_and_66_years, 
  pct_total_female_67_to_69_years, 
  pct_total_female_70_to_74_years, 
  pct_total_female_75_to_79_years, 
  pct_total_female_80_to_84_years, 
  pct_total_female_85_years_and_over
)


kable(sum_demog, digits=2)
```

Merge station-level demographic data with station-level pollution reduction data.

Calculate the average emissions that each demographic group sees by using the formula below:

$\dfrac{Hisp_{area1} \times Reduction_{area1} + Hisp_{area2} \times Reduction_{area2}}{Hisp_{area1} + Hisp_{area2}}$

```{r}
alldf<-cbind(output, coef)
```

```{r}
reddf<-alldf %>%
  mutate(total_male_change=total_male*coef,
       total_male_under_5_years_change=total_male_under_5_years*coef,
       total_male_5_to_9_years_change=total_male_5_to_9_years*coef,
       total_male_10_to_14_years_change=total_male_10_to_14_years*coef,
       total_male_15_to_17_years_change=total_male_15_to_17_years*coef,
       total_male_18_and_19_years_change=total_male_18_and_19_years*coef,
       total_male_20_years_change=total_male_20_years*coef,
       total_male_21_years_change=total_male_21_years*coef,
       total_male_22_to_24_years_change=total_male_22_to_24_years*coef,
       total_male_25_to_29_years_change=total_male_25_to_29_years*coef,
       total_male_30_to_34_years_change=total_male_30_to_34_years*coef,
       total_male_35_to_39_years_change=total_male_35_to_39_years*coef,
       total_male_40_to_44_years_change=total_male_40_to_44_years*coef,
       total_male_45_to_49_years_change=total_male_45_to_49_years*coef,
       total_male_50_to_54_years_change=total_male_50_to_54_years*coef,
       total_male_55_to_59_years_change=total_male_55_to_59_years*coef,
       total_male_60_and_61_years_change=total_male_60_and_61_years*coef,
       total_male_62_to_64_years_change=total_male_62_to_64_years*coef,
       total_male_65_and_66_years_change=total_male_65_and_66_years*coef,
       total_male_67_to_69_years_change=total_male_67_to_69_years*coef,
       total_male_70_to_74_years_change=total_male_70_to_74_years*coef,
       total_male_75_to_79_years_change=total_male_75_to_79_years*coef,
       total_male_80_to_84_years_change=total_male_80_to_84_years*coef,
       total_male_85_years_and_over_change=total_male_85_years_and_over*coef,
       total_female_change=total_female*coef,
       total_female_under_5_years_change=total_female_under_5_years*coef,
       total_female_5_to_9_years_change=total_female_5_to_9_years*coef,
       total_female_10_to_14_years_change=total_female_10_to_14_years*coef,
       total_female_15_to_17_years_change=total_female_15_to_17_years*coef,
       total_female_18_and_19_years_change=total_female_18_and_19_years*coef,
       total_female_20_years_change=total_female_20_years*coef,
       total_female_21_years_change=total_female_21_years*coef,
       total_female_22_to_24_years_change=total_female_22_to_24_years*coef,
       total_female_25_to_29_years_change=total_female_25_to_29_years*coef,
       total_female_30_to_34_years_change=total_female_30_to_34_years*coef,
       total_female_35_to_39_years_change=total_female_35_to_39_years*coef,
       total_female_40_to_44_years_change=total_female_40_to_44_years*coef,
       total_female_45_to_49_years_change=total_female_45_to_49_years*coef,
       total_female_50_to_54_years_change=total_female_50_to_54_years*coef,
       total_female_55_to_59_years_change=total_female_55_to_59_years*coef,
       total_female_60_and_61_years_change=total_female_60_and_61_years*coef,
       total_female_62_to_64_years_change=total_female_62_to_64_years*coef,
       total_female_65_and_66_years_change=total_female_65_and_66_years*coef,
       total_female_67_to_69_years_change=total_female_67_to_69_years*coef,
       total_female_70_to_74_years_change=total_female_70_to_74_years*coef,
       total_female_75_to_79_years_change=total_female_75_to_79_years*coef,
       total_female_80_to_84_years_change=total_female_80_to_84_years*coef,
       total_female_85_years_and_over_change=total_female_85_years_and_over*coef) %>%
summarize(total_male_change_sum=sum(total_male_change),
          total_male_under_5_years_change_sum=sum(total_male_under_5_years_change),
          total_male_5_to_9_years_change_sum=sum(total_male_5_to_9_years_change),
          total_male_10_to_14_years_change_sum=sum(total_male_10_to_14_years_change),
          total_male_15_to_17_years_change_sum=sum(total_male_15_to_17_years_change),
          total_male_18_and_19_years_change_sum=sum(total_male_18_and_19_years_change),
          total_male_20_years_change_sum=sum(total_male_20_years_change),
          total_male_21_years_change_sum=sum(total_male_21_years_change),
          total_male_22_to_24_years_change_sum=sum(total_male_22_to_24_years_change),
          total_male_25_to_29_years_change_sum=sum(total_male_25_to_29_years_change),
          total_male_30_to_34_years_change_sum=sum(total_male_30_to_34_years_change),
          total_male_35_to_39_years_change_sum=sum(total_male_35_to_39_years_change),
          total_male_40_to_44_years_change_sum=sum(total_male_40_to_44_years_change),
          total_male_45_to_49_years_change_sum=sum(total_male_45_to_49_years_change),
          total_male_50_to_54_years_change_sum=sum(total_male_50_to_54_years_change),
          total_male_55_to_59_years_change_sum=sum(total_male_55_to_59_years_change),
          total_male_60_and_61_years_change_sum=sum(total_male_60_and_61_years_change),
          total_male_62_to_64_years_change_sum=sum(total_male_62_to_64_years_change),
          total_male_65_and_66_years_change_sum=sum(total_male_65_and_66_years_change),
          total_male_67_to_69_years_change_sum=sum(total_male_67_to_69_years_change),
          total_male_70_to_74_years_change_sum=sum(total_male_70_to_74_years_change),
          total_male_75_to_79_years_change_sum=sum(total_male_75_to_79_years_change),
          total_male_80_to_84_years_change_sum=sum(total_male_80_to_84_years_change),
          total_male_85_years_and_over_change_sum=sum(total_male_85_years_and_over_change),
          total_female_change_sum=sum(total_female_change),
          total_female_under_5_years_change_sum=sum(total_female_under_5_years_change),
          total_female_5_to_9_years_change_sum=sum(total_female_5_to_9_years_change),
          total_female_10_to_14_years_change_sum=sum(total_female_10_to_14_years_change),
          total_female_15_to_17_years_change_sum=sum(total_female_15_to_17_years_change),
          total_female_18_and_19_years_change_sum=sum(total_female_18_and_19_years_change),
          total_female_20_years_change_sum=sum(total_female_20_years_change),
          total_female_21_years_change_sum=sum(total_female_21_years_change),
          total_female_22_to_24_years_change_sum=sum(total_female_22_to_24_years_change),
          total_female_25_to_29_years_change_sum=sum(total_female_25_to_29_years_change),
          total_female_30_to_34_years_change_sum=sum(total_female_30_to_34_years_change),
          total_female_35_to_39_years_change_sum=sum(total_female_35_to_39_years_change),
          total_female_40_to_44_years_change_sum=sum(total_female_40_to_44_years_change),
          total_female_45_to_49_years_change_sum=sum(total_female_45_to_49_years_change),
          total_female_50_to_54_years_change_sum=sum(total_female_50_to_54_years_change),
          total_female_55_to_59_years_change_sum=sum(total_female_55_to_59_years_change),
          total_female_60_and_61_years_change_sum=sum(total_female_60_and_61_years_change),
          total_female_62_to_64_years_change_sum=sum(total_female_62_to_64_years_change),
          total_female_65_and_66_years_change_sum=sum(total_female_65_and_66_years_change),
          total_female_67_to_69_years_change_sum=sum(total_female_67_to_69_years_change),
          total_female_70_to_74_years_change_sum=sum(total_female_70_to_74_years_change),
          total_female_75_to_79_years_change_sum=sum(total_female_75_to_79_years_change),
          total_female_80_to_84_years_change_sum=sum(total_female_80_to_84_years_change),
          total_female_85_years_and_over_change_sum=sum(total_female_85_years_and_over_change),
          total_male=sum(total_male),
          total_male_under_5_years=sum(total_male_under_5_years),
          total_male_5_to_9_years=sum(total_male_5_to_9_years),
          total_male_10_to_14_years=sum(total_male_10_to_14_years),
          total_male_15_to_17_years=sum(total_male_15_to_17_years),
          total_male_18_and_19_years=sum(total_male_18_and_19_years),
          total_male_20_years=sum(total_male_20_years),
          total_male_21_years=sum(total_male_21_years),
          total_male_22_to_24_years=sum(total_male_22_to_24_years),
          total_male_25_to_29_years=sum(total_male_25_to_29_years),
          total_male_30_to_34_years=sum(total_male_30_to_34_years),
          total_male_35_to_39_years=sum(total_male_35_to_39_years),
          total_male_40_to_44_years=sum(total_male_40_to_44_years),
          total_male_45_to_49_years=sum(total_male_45_to_49_years),
          total_male_50_to_54_years=sum(total_male_50_to_54_years),
          total_male_55_to_59_years=sum(total_male_55_to_59_years),
          total_male_60_and_61_years=sum(total_male_60_and_61_years),
          total_male_62_to_64_years=sum(total_male_62_to_64_years),
          total_male_65_and_66_years=sum(total_male_65_and_66_years),
          total_male_67_to_69_years=sum(total_male_67_to_69_years),
          total_male_70_to_74_years=sum(total_male_70_to_74_years),
          total_male_75_to_79_years=sum(total_male_75_to_79_years),
          total_male_80_to_84_years=sum(total_male_80_to_84_years),
          total_male_85_years_and_over=sum(total_male_85_years_and_over),
          total_female=sum(total_female),
          total_female_under_5_years=sum(total_female_under_5_years),
          total_female_5_to_9_years=sum(total_female_5_to_9_years),
          total_female_10_to_14_years=sum(total_female_10_to_14_years),
          total_female_15_to_17_years=sum(total_female_15_to_17_years),
          total_female_18_and_19_years=sum(total_female_18_and_19_years),
          total_female_20_years=sum(total_female_20_years),
          total_female_21_years=sum(total_female_21_years),
          total_female_22_to_24_years=sum(total_female_22_to_24_years),
          total_female_25_to_29_years=sum(total_female_25_to_29_years),
          total_female_30_to_34_years=sum(total_female_30_to_34_years),
          total_female_35_to_39_years=sum(total_female_35_to_39_years),
          total_female_40_to_44_years=sum(total_female_40_to_44_years),
          total_female_45_to_49_years=sum(total_female_45_to_49_years),
          total_female_50_to_54_years=sum(total_female_50_to_54_years),
          total_female_55_to_59_years=sum(total_female_55_to_59_years),
          total_female_60_and_61_years=sum(total_female_60_and_61_years),
          total_female_62_to_64_years=sum(total_female_62_to_64_years),
          total_female_65_and_66_years=sum(total_female_65_and_66_years),
          total_female_67_to_69_years=sum(total_female_67_to_69_years),
          total_female_70_to_74_years=sum(total_female_70_to_74_years),
          total_female_75_to_79_years=sum(total_female_75_to_79_years),
          total_female_80_to_84_years=sum(total_female_80_to_84_years),
          total_female_85_years_and_over=sum(total_female_85_years_and_over)) %>%
mutate(total_male_change_ave=total_male_change_sum*100/total_male,
       total_male_under_5_years_change_ave=total_male_under_5_years_change_sum*100/total_male_under_5_years,
       total_male_5_to_9_years_change_ave=total_male_5_to_9_years_change_sum*100/total_male_5_to_9_years,
       total_male_10_to_14_years_change_ave=total_male_10_to_14_years_change_sum*100/total_male_10_to_14_years,
       total_male_15_to_17_years_change_ave=total_male_15_to_17_years_change_sum*100/total_male_15_to_17_years,
       total_male_18_and_19_years_change_ave=total_male_18_and_19_years_change_sum*100/total_male_18_and_19_years,
       total_male_20_years_change_ave=total_male_20_years_change_sum*100/total_male_20_years,
       total_male_21_years_change_ave=total_male_21_years_change_sum*100/total_male_21_years,
       total_male_22_to_24_years_change_ave=total_male_22_to_24_years_change_sum*100/total_male_22_to_24_years,
       total_male_25_to_29_years_change_ave=total_male_25_to_29_years_change_sum*100/total_male_25_to_29_years,
       total_male_30_to_34_years_change_ave=total_male_30_to_34_years_change_sum*100/total_male_30_to_34_years,
       total_male_35_to_39_years_change_ave=total_male_35_to_39_years_change_sum*100/total_male_35_to_39_years,
       total_male_40_to_44_years_change_ave=total_male_40_to_44_years_change_sum*100/total_male_40_to_44_years,
       total_male_45_to_49_years_change_ave=total_male_45_to_49_years_change_sum*100/total_male_45_to_49_years,
       total_male_50_to_54_years_change_ave=total_male_50_to_54_years_change_sum*100/total_male_50_to_54_years,
       total_male_55_to_59_years_change_ave=total_male_55_to_59_years_change_sum*100/total_male_55_to_59_years,
       total_male_60_and_61_years_change_ave=total_male_60_and_61_years_change_sum*100/total_male_60_and_61_years,
       total_male_62_to_64_years_change_ave=total_male_62_to_64_years_change_sum*100/total_male_62_to_64_years,
       total_male_65_and_66_years_change_ave=total_male_65_and_66_years_change_sum*100/total_male_65_and_66_years,
       total_male_67_to_69_years_change_ave=total_male_67_to_69_years_change_sum*100/total_male_67_to_69_years,
       total_male_70_to_74_years_change_ave=total_male_70_to_74_years_change_sum*100/total_male_70_to_74_years,
       total_male_75_to_79_years_change_ave=total_male_75_to_79_years_change_sum*100/total_male_75_to_79_years,
       total_male_80_to_84_years_change_ave=total_male_80_to_84_years_change_sum*100/total_male_80_to_84_years,
       total_male_85_years_and_over_change_ave=total_male_85_years_and_over_change_sum*100/total_male_85_years_and_over,
       total_female_change_ave=total_female_change_sum*100/total_female,
       total_female_under_5_years_change_ave=total_female_under_5_years_change_sum*100/total_female_under_5_years,
       total_female_5_to_9_years_change_ave=total_female_5_to_9_years_change_sum*100/total_female_5_to_9_years,
       total_female_10_to_14_years_change_ave=total_female_10_to_14_years_change_sum*100/total_female_10_to_14_years,
       total_female_15_to_17_years_change_ave=total_female_15_to_17_years_change_sum*100/total_female_15_to_17_years,
       total_female_18_and_19_years_change_ave=total_female_18_and_19_years_change_sum*100/total_female_18_and_19_years,
       total_female_20_years_change_ave=total_female_20_years_change_sum*100/total_female_20_years,
       total_female_21_years_change_ave=total_female_21_years_change_sum*100/total_female_21_years,
       total_female_22_to_24_years_change_ave=total_female_22_to_24_years_change_sum*100/total_female_22_to_24_years,
       total_female_25_to_29_years_change_ave=total_female_25_to_29_years_change_sum*100/total_female_25_to_29_years,
       total_female_30_to_34_years_change_ave=total_female_30_to_34_years_change_sum*100/total_female_30_to_34_years,
       total_female_35_to_39_years_change_ave=total_female_35_to_39_years_change_sum*100/total_female_35_to_39_years,
       total_female_40_to_44_years_change_ave=total_female_40_to_44_years_change_sum*100/total_female_40_to_44_years,
       total_female_45_to_49_years_change_ave=total_female_45_to_49_years_change_sum*100/total_female_45_to_49_years,
       total_female_50_to_54_years_change_ave=total_female_50_to_54_years_change_sum*100/total_female_50_to_54_years,
       total_female_55_to_59_years_change_ave=total_female_55_to_59_years_change_sum*100/total_female_55_to_59_years,
       total_female_60_and_61_years_change_ave=total_female_60_and_61_years_change_sum*100/total_female_60_and_61_years,
       total_female_62_to_64_years_change_ave=total_female_62_to_64_years_change_sum*100/total_female_62_to_64_years,
       total_female_65_and_66_years_change_ave=total_female_65_and_66_years_change_sum*100/total_female_65_and_66_years,
       total_female_67_to_69_years_change_ave=total_female_67_to_69_years_change_sum*100/total_female_67_to_69_years,
       total_female_70_to_74_years_change_ave=total_female_70_to_74_years_change_sum*100/total_female_70_to_74_years,
       total_female_75_to_79_years_change_ave=total_female_75_to_79_years_change_sum*100/total_female_75_to_79_years,
       total_female_80_to_84_years_change_ave=total_female_80_to_84_years_change_sum*100/total_female_80_to_84_years,
       total_female_85_years_and_over_change_ave=total_female_85_years_and_over_change_sum*100/total_female_85_years_and_over)

```
